<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Mirage : Complext test automation made easy">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Mirage</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/SpectoLabs/mirage">View on GitHub</a>

          <h1 id="project_title">Mirage</h1>
          <h2 id="project_tagline">Complext test automation made easy</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/SpectoLabs/mirage/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/SpectoLabs/mirage/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="mirage" class="anchor" href="#mirage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mirage</h1>

<p><a href="https://travis-ci.org/SpectoLabs/mirage"><img src="https://travis-ci.org/SpectoLabs/mirage.png?branch=master" alt="Build Status"></a>
<a href="http://mirage.readthedocs.org/en/latest/?badge=latest"><img src="https://readthedocs.org/projects/mirage/badge/?version=latest" alt="Documentation Status"></a>
<a href="https://gitter.im/SpectoLabs/mirage?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=body_badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter"></a></p>

<p>Enable automated testing by mastering system dependencies.
Use when reality is simply not good enough.</p>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>See the The documentation <a href="http://mirage.readthedocs.org/en/latest/?badge=latest/">readthedocs</a> to view
user documentation.</p>

<h2>
<a id="install-and-run-docker--docker-compose" class="anchor" href="#install-and-run-docker--docker-compose" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install and run (Docker + Docker Compose)</h2>

<p>Install Docker and Docker Compose.</p>

<ul>
<li>cd to project root</li>
<li>docker-compose up</li>
<li>[http://localhost:8001] or if you are using boot2docker (Mac OSX) - check VM's IP address with command:
$ boot2docker ip</li>
</ul>

<h2>
<a id="install-manual" class="anchor" href="#install-manual" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install (Manual)</h2>

<p>(Linux Red Hat Enterprise, CentOS, Fedora, or Amazon Linux). It's easier when using python virtualenv wrapper, get more 
information about installing and using it here: [<a href="https://virtualenvwrapper.readthedocs.org/en/latest/">https://virtualenvwrapper.readthedocs.org/en/latest/</a>]</p>

<p>Redis Server Installation::</p>

<pre><code>$ sudo yum install redis-server
$ sudo service redis-server start
</code></pre>

<p>Mongo server Installation::</p>

<pre><code>$ sudo yum install mongodb-org
$ sudo service mongod start | stop
</code></pre>

<p>dependencies::</p>

<pre><code>$ sudo yum install python27-virtualenv libxslt libxslt-devel libxml2 libxml2-devel texlive-full
</code></pre>

<p>(Linux Ubuntu) </p>

<p>Redis Server Installation::</p>

<pre><code>$ sudo apt-get install -y redis-server
$ sudo service redis-server start
</code></pre>

<p>Mongo server Installation::</p>

<pre><code>$ sudo apt-get install -y mongodb-org
$ sudo service mongod start | stop
</code></pre>

<p>dependencies::</p>

<pre><code>$ sudo apt-get install -y python-dev python-pip wget python2.7-dev libxml2 libxml2-dev libxslt1-dev
</code></pre>

<p>Download application:</p>

<pre><code>(env) $ git clone https://github.com/Stub-O-Matic/stubo-app.git

(env) $ cd stubo-app

(env) $ mkv

(env) $ pip install -r requirements/development.txt  (in production environment use pip install -r requirements.txt)
</code></pre>

<blockquote>
<p>Installing lxml library on OSX:
export CFLAGS=-Qunused-arguments
export CPPFLAGS=-Qunused-arguments</p>

<p>pip install lxml
or following if installing globally
sudo pip install lxml</p>
</blockquote>

<h3>
<a id="run" class="anchor" href="#run" aria-hidden="true"><span class="octicon octicon-link"></span></a>RUN</h3>

<p>Perform the following::</p>

<pre><code>$ sudo service mongod start
$ sudo service redis-server start
</code></pre>

<p>Active your virtual python env:</p>

<pre><code>$ workon env
</code></pre>

<p>Launch run.py in project root:</p>

<pre><code>$ python run.py
</code></pre>

<p>Logs are in <em>PROJECT_ROOT</em>/log/stubo.log
Default config is picked up from <em>PROJECT_ROOT</em>/dev.ini<br>
Alternatively you can run from another location:</p>

<pre><code>(env) $ python run.py -c path_to_config
</code></pre>

<h2>
<a id="functional-testing" class="anchor" href="#functional-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>FUNCTIONAL TESTING</h2>

<p>You can run the test suite by running the following command 
(in the project root: stubo-app)::</p>

<pre><code>    (env) $ nosetests stubo
</code></pre>

<p>Use the <code>-x</code> flag to stop the tests at the first error::</p>

<pre><code>    (env) $ nosetests stubo -x
</code></pre>

<p>Or to run a specific test:</p>

<pre><code>     (env) $ nosetests stubo.tests.integration.test_api:TestAcceptance.test_exec_first_commands
</code></pre>

<p>Use the <code>--with-coverage</code> flag to display a coverage report after
running the tests, this will show you which files / lines have not
been executed when the tests ran::</p>

<pre><code>    (env) $ nosetests stubo --with-coverage --cover-package=stubo
</code></pre>

<p>Or to run a specific test:</p>

<pre><code>    (env) $ nosetests stubo.tests.integration.test_api:TestAcceptance.test_exec_first_commands
</code></pre>

<p>and code analysis </p>

<pre><code>    (env) $ pylint stubo
</code></pre>

<h2>
<a id="debugging" class="anchor" href="#debugging" aria-hidden="true"><span class="octicon octicon-link"></span></a>DEBUGGING</h2>

<p>If you want to call functions to debug in a python shell and they have a 
dependency on redis or mongo you must initialise them first</p>

<pre><code>from stubo.utils import start_redis
slave, master = start_redis({})
slave
&lt;redis.client.Redis object at 0x10168e650&gt; 

from stubo.utils import init_mongo
dbclient = init_mongo()
dbclient
Database(MongoClient('localhost', 27017), u'stubodb')
</code></pre>

<p>Now you can make calls that use redis</p>

<pre><code>&gt;&gt;&gt; from stubo.cache import Cache
&gt;&gt;&gt; cache = Cache(host='localhost')
&gt;&gt;&gt; cache.get_session('first', 'first_1')
    {u'status': u'dormant', u'system_date': u'2015-02-24', u'scenario': u'localhost:first', u'last_used': u'2015-02-24 11:19:21', u'scenario_id': u'54ec5e3981875908f911a71b', u'session': u'first_1'}
</code></pre>

<p>&amp; mongodb</p>

<pre><code>from stubo.model.db import Scenario
scenario = Scenario()
stubs = list(scenario.get_stubs('localhost:first'))
import pprint
pp = pprint.PrettyPrinter(indent=4)
pp.pprint(stubs[0])
{   u'_id': ObjectId('537c8f1cac5f7303ad704d85'),
    u'scenario': u'localhost:first',
    u'stub': {   u'recorded': u'2014-05-21',
                 u'request': {   u'bodyPatterns': [   {   u'contains': [   u'get my stub\n']}],
                                 u'method': u'POST'},
                 u'response': {   u'body': u'Hello {{1+1}} World\n',
                                  u'delayPolicy': u'slow',
                                  u'status': 200}}}

from stubo.model.db import Tracker
tracker = Tracker()
list(tracker.find_tracker_data({'function' : 'get/response'}, 0, 1))
[{u'function': u'get/response', u'scenario': u'conv', u'start_time': datetime.datetime(2013, 10, 29, 10, 38, 16, 534000, tzinfo=&lt;bson.tz_util.FixedOffset object at 0x1015b6910&gt;), u'return_code': 200, u'session': u'mary', u'duration_ms': 5, u'stubo_response': u'a2 response\n', u'_id': ObjectId('526f90180cfb4403fc27c0fa')}]
</code></pre>

<h2>
<a id="performance-testing" class="anchor" href="#performance-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>PERFORMANCE TESTING</h2>

<p>Load performance test data (over 10,000 stubs in 100 scenarios) with </p>

<pre><code>    stubo/api/exec/cmds?cmdfile=/static/cmds/perf/perf_setup.commands 
    this will take some time to run and leaves 100 sessions in playback mode.

    optionally demonstrate that the load was successfull with:
    stubo/api/exec/cmds?cmdfile=/static/cmds/perf/perf_getresponse.commands
    this gets one response from each session.

    When finished end sessions and delete stubs with:
    stubo/api/exec/cmds?cmdfile=/static/cmds/perf/perf_teardown.commands
</code></pre>

<h2>
<a id="documentation-1" class="anchor" href="#documentation-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>DOCUMENTATION</h2>

<p>Documentation is generated with Sphinx. The doc sources are located under /docs.</p>

<p>prerequisites for generating PDF:</p>

<pre><code>$ yum install texlive
</code></pre>

<p>To generate docs</p>

<pre><code>(env) $ python setup.py build_sphinx --build-dir=./stubo/static/docs
</code></pre>

<p>To generate PDF</p>

<pre><code>   $ cd docs
   $ make latexpdf
   $ cp _build/latex/Stub-O-Matic.pdf ../stubo/static/docs
</code></pre>

<h2>
<a id="profiling" class="anchor" href="#profiling" aria-hidden="true"><span class="octicon octicon-link"></span></a>PROFILING</h2>

<p>Mirage profiling is available via two different profilers yappi and plop. </p>

<p>yappi function stats</p>

<pre><code>name: name of the function being profiled
#n: is the total callcount of the function.
tsub: total spent time in the function minus the total time spent in the other functions called from this function.
ttot: total time spent in the function.
tavg: is same as ttot/ccnt. Average total time.
</code></pre>

<p>Plop is a stack-sampling profiler for Python. Profile collection can be turned on and off in a live process with minimal performance impact.</p>

<p>Both profilers are enabled via an HTTP inteface in stubo.</p>

<p>yappi - generate stats for 3 mins, output is saved to a csv file: </p>

<pre><code>_profile?interval=180
</code></pre>

<p>plop - generate stats for 3 mins, output is saved by default to /tmp/plop.out:</p>

<pre><code>_profile2?interval=180&amp;output=/tmp/plop.out
</code></pre>

<p>To view plop results in a bubble graph:</p>

<pre><code>(env) $ python -m plop.viewer --datadir=/tmp
</code></pre>

<p>View via the plop app at http://localhost:8888</p>

<h3>
<a id="authors" class="anchor" href="#authors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors</h3>

<p>Mirage is made available by <a href="http://opencredo.com">OpenCredo</a>
and a team of contributors.</p>

<h3>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h3>

<p>Mirage is offered under GPLv3, see LICENSE for more details.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Mirage maintained by <a href="https://github.com/SpectoLabs">SpectoLabs</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
